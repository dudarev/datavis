===========================
Добыча информации в Twitter
===========================
-----------------
14 января 2010 г.
-----------------

23 января в Запорожье пройдет `#UKRTWEET <http://ukrtweet.com.ua/>`_ -- первый всеукраинский баркэмп посвященный Twitter. Граф выше показывает, кто из его участников, с кем разговаривает и кого упоминает. Заметка ниже посвящена анализу этого графа.

О data mining в Twitter я буду говорить 16 января на первой в этом году донецкой встрече "Кофе и код", которая пройдет в кофейне "`Изба-читальня <http://www.izba4i.com>`_" с 13:00 до 15:00. Поэтому здесь параллельно проведу анализ группы людей из Донецка, которые пишут в Twitter.

Добывать информацию

Анализ информации здесь, в основном, проводится при помощи Python. Весь код лежит на `github <http://github.com/dudarev/datavis/tree/master/004_twitter_graph/>`_, в каждой секции есть ссылки на соответствующие скрипты. В конце заметки перечислены все используемые библиотеки. Надеюсь, и без просмотра кода в заметке можно найти любопытную информацию.

1. Получение информации
-----------------------
Для начала, получаем список всех участников групп. `Список участников <http://ukrtweet.com.ua/?page_id=10'>`_ #UKRTWEET есть на странице баркэмпа. Скачиваем и парсим его при помощи `BeautifulSoup <http://www.crummy.com/software/BeautifulSoup/>`_ (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/get_members_page.py>`__). Для людей, которые твитят из Донецка, я веду список `@dudarev/donetsk <http://twitter.com/dudarev/donetsk>`_. Сохраняем его участников при помощи библиотеки `tweepy <http://github.com/joshthecoder/tweepy>`_ (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/get_members_list.py>`__).

Для каждого из участников скачиваем последние 100 твитов и сохраняем их. Tweepy автоматически парсит JSON, а так как в этот раз мы хотим сохранить данные такими какие они есть, то немного подправляем класс tweepy.API (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/get_timelines.py>`__).

2. О чем говорят
----------------

Теперь можно анализировать информацию. Давайте посмотрим какие хэштеги наиболее часто употреблялись каждой группой. Для этого напишем утилиту, которая принимая строку возвращает список всех встречающихся в ней хэштегов. Для ее написания `TDD <http://ru.wikipedia.org/wiki/Разработка_через_тестирование>`__ -- весьма кстати (`смотрим код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/find_hash.py>`__). С помощью этой утилиты парсим все твиты (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/parse_tweets.py>`__).

Наиболее часто-упоминаемые хэштеги участниками #UKRTWEET (число в скобках -- количество разных людей, которые использовали этот хэштег):

1. ukrtweet (15)
2. sledui (13)
3. nicua (7)
4. google (6)
5. zp_ua (5)
6. ru_ff (5)
7. habr (5)
8. twitter (4)
9. rutwitter (4)
10. ff (4)
11. elect_ua (4)

Люди из Донецка упоминали:

1. donetsk (25)
2. habr (10)
3. wave (6)
4. ru_ff (6)
5. linux (6)
6. ukraine (5)
7. sledui (5)
8. radiot (5)
9. google (5)
10. codejam (5)
11. 2010sms (5)

Как видим, в каждой группе, хэштег, описывающий группу -- на первом месте по употреблению. Есть и общие интересы: habr, ru_ff, sledui, google.

3. Когда говорят
----------------

Давайте посмотрим, в какое время, группа проявляет наибольшую активность. Для этого воспользуемся тем же самым скриптом, пробегающим по всем твитам, но на этот раз сформируем списки количества твитов в данный час дня и сохраним их в отдельных файлах (опция '-t' при вызове из коммандной строки). Изобразим диаграмы при помощи библиотеки `Matplotlib <http://matplotlib.sourceforge.net/>`_ (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/plot_hour_count.py>`__).

.. image:: http://farm5.static.flickr.com/4028/4274484106_327a61a43c.jpg

Участники #UKRTWEET проявляют активность выше средней с 10 утра до 1 часа ночи по киевскому времени, с пиком около 5 часов вечера.

.. image:: http://farm5.static.flickr.com/4023/4273739261_9480a18aca.jpg

Дончане активны в то же время, но пик наблюдается около 11 вечера. Быть может, это потому что люди собирающиеся на баркэмп рассматривают Twitter как рабочий инструмент и активны в нем в рабочее время. Хотя, из-за недавних праздников, эти данные могут быть непоказательными.

4. Социальный граф
--------------------------------

Граф из данных Twitter можно строить различными способами. Здесь мы будем следовать следующей конструкции: если человек А упомянул человека Б хотя бы один раз (не важно ретвит или ответ), от вершины А к вершине Б строим ориентированное ребро. Граф не взвешенный, то есть ребро строим только единожды.

Все тот же скрипт с опцией '-g' выстраивает из сохраненных твитов словарь представляющий такой граф и сохраняет его в формате JSON для последующего анализа (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/parse_tweets.py>`__).

Несколько количественных наблюдений. В группе #UKRTWEET 52% упоминают кого-то из группы (55/106). А всего упоминают 933 человека что в 8.8 раз больше самой группы (933/106).

В донецкой же группе 45% вовлечены в группу (102/225), а всего различных упоминаний в 4.4 раза больше самой группы (998/225). Явно, что люди, которые собираются посетить баркэмп о Twitter более активно используют его как средство общения.

5. Авторитетность
----------------------------

Авторитетность в социальном графе можно анализировать разными способами. Самый простой -- отсортировать участников по количеству входящих ребер. У кого больше -- тот больше авторитетен. В поиске по Интернету Google в качестве одного из критериев для авторитетности страниц использует PageRank. Он вычисляется при помощи случайного блуждания по графу, где в качестве узлов -- страницы, а ребро между узлами -- если одна страница ссылается на другую. Случайный блуждатель двигается по графу и с какой-то малой вероятностью перемещается на случайный узел и начинает блуждание заново. PageRank равен доли пребывания на каком-то узле за все время блуждания. Чем он больше, тем узел более авторитетен.

Здесь мы остановимся только на двух вышеупомянутых критериях. Стоит упомянуть, что при анализе социальных графов большое внимание уделяют `различным центральностям <http://en.wikipedia.org/wiki/Centrality>`__. Их использование в качестве критерия авторитетности может иметь больший смысл для более распределенных графов.

Одна из распространенных библиотек Python для работы с графами -- `NetworkX <http://networkx.lanl.gov/>`__. Ее мы и будем использовать. Создав граф G, считать различные его параметры очень удобно. Так, например, чтобы посчитать PageRank всех узлов, достаточно написать: ::

    pr = networkx.pagerank(G,alpha=0.85,max_iter=200)

Хочется подчеркнуть, что все числа ниже -- для искуственно выделенных  из твиттерсферы групп. Те же самые люди, могут быть глобально более влиятельными и авторитетными. Числа ниже -- для комуникаций внутри данных групп.

Давайте отобразим зависимость PageRank для всех узлов от количества узлов, которые на них указывают (`код <http://github.com/dudarev/datavis/blob/master/004_twitter_graph/plot_pr_followers.py>`__).

.. image:: http://farm5.static.flickr.com/4041/4275091706_0807736a9a.jpg

Естественно, большой авторитет у двух организаторов (`@karelina <http://twitter.com/karelina>`_ и `@u02 <http://twitter.com/u02>`_). У известного украинского блогера `@woofer_kyyivu <http://twitter.com/woofer_kyyiv>`_ авторитетность так же высока, хотя и упоминают меньше людей, но упоминают равномерно по группе. Авторитетность официального аккаунта баркэмпа (`@ukrtweet <http://twitter.com/ukrtweet>`_) существенно ниже. Одна из интерпретаций: люди предпочитают общаться и упоминать людей. Быть может поэтому во многих официальных западных аккаунтах явно указываются имена вещающих.

.. image:: http://farm3.static.flickr.com/2703/4275091740_3b9cc7d6ff.jpg 

Безусловный лидер внутри донецкой группы -- `@quantizer <http://twitter.com/quantizer>`_. Различия в PageRank при схожих количествах упоминаний для следующих участников можно трактовать, например, так: `@olchik_terl <http://twitter.com/olchik_terl>`_ и `@lancerenok <http://twitter.com/lancerenok>`_ больше общаются с людьми из разных частей социального графа группы, тогда как `@lapidarius <http://twitter.com/lapidarius>`_, `@meesix <http://twitter.com/meesix>`_ и `@alderko <http://twitter.com/alderko>`_ больше взаимодействуют со своими локальными сообществами (в основном выделенными по профессиональному признаку), поэтому у второй группы PageRank чуть ниже, чем у первой.

6. Влияющие извне
-----------------

7. Сообщества
--------------

8. Метки для сообществ
----------------------

Упражнения
----------------------

1. Какими средствами в группе чаще всего пользуются чтобы твитить (web, TweetDeck, Echofon,...)?
2. betweenness_centrality eigenvector_centrality

Используемые библиотеки
-----------------------------------

`Matplotlib`_
    позволяет рисовать

http://igraph.sourceforge.net
